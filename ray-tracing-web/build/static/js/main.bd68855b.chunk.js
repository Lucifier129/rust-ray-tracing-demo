(this["webpackJsonpray-tracing-web"]=this["webpackJsonpray-tracing-web"]||[]).push([[1],{136:function(e,t,a){"use strict";a.r(t);var n=a(11),r=a(67),c=a(0),i=a.n(c),u=a(6),o=a.n(u),s=a(13),l=a(14),f=a(2),h=a.n(f),d=a(16),v=a(17),m=a(66).vec3,b=a(84),p=b._add_,w=b._sub_,k=b._mul_,x=b._div_,g=b._negate_,y=function(e,t,a){return m.fromValues(e,t,a)},j=function(e,t){return m.dot(e,t)},O=function(e,t){return m.cross(m.create(),e,t)},M=function(e){return m.normalize(m.create(),e)},A=function(){function e(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(d.a)(this,e),this.a=t,this.b=a,this.time=n}return Object(v.a)(e,[{key:"origin",value:function(){return this.a}},{key:"direction",value:function(){return this.b}},{key:"pointAt",value:function(e){var t=this.a,a=this.b;return p(t,k(e,a))}}]),e}(),E=function(e,t,a){return p(k(w(1,e),t),k(e,a))},F=function(){return{t:0,p:m.create(),normal:m.create()}},R=function(){function e(t,a,n){Object(d.a)(this,e),this.center=t,this.radius=a,this.material=n}return Object(v.a)(e,[{key:"setCenter",value:function(e){this.center=e}},{key:"hit",value:function(e,t,a,n){var r=w(e.origin(),this.center),c=j(e.direction(),e.direction()),i=j(r,e.direction()),u=w(j(r,r),k(this.radius,this.radius)),o=w(k(i,i),k(c,u));if(o<0)return!1;var s=x(w(g(i),Math.sqrt(o)),c),l=s<a&&s>t;return l||(l=(s=x(p(g(i),Math.sqrt(o)),c))<a&&s>t),!!l&&(n.t=s,n.p=e.pointAt(s),n.normal=x(w(n.p,this.center),this.radius),n.material=this.material,!0)}}]),e}(),D=function(){function e(t,a,n,r,c,i){Object(d.a)(this,e),this.center1=t,this.center2=a,this.time1=n,this.time2=r,this.sphere=new R(t,c,i)}return Object(v.a)(e,[{key:"hit",value:function(e,t,a,n){var r,c,i,u,o,s=(r=this.center1,c=this.center2,i=this.time1,u=this.time2,o=e.time,p(r,k(x(w(o,i),w(u,i)),w(c,r))));return this.sphere.setCenter(s),this.sphere.hit(e,t,a,n)}}]),e}(),_=function(){function e(t){Object(d.a)(this,e),this.list=t}return Object(v.a)(e,[{key:"hit",value:function(e,t,a,n){var r,c=F(),i=!1,u=a,o=Object(l.a)(this.list);try{for(o.s();!(r=o.n()).done;){r.value.hit(e,t,u,c)&&(i=!0,u=c.t,Object.assign(n,c))}}catch(s){o.e(s)}finally{o.f()}return i}},{key:"push",value:function(){var e;(e=this.list).push.apply(e,arguments)}}]),e}(),I=function(){function e(t,a,n,r,c,i,u,o,s){Object(d.a)(this,e);var l=x(k(r,Math.PI),180),f=Math.tan(x(l,2)),h=k(f,c),v=t,m=M(w(t,a)),b=M(O(n,m)),g=O(m,b),y=w(v,k(u,p(p(k(b,h),k(g,f)),m))),j=k(k(k(u,2),b),h),A=k(k(k(u,2),g),f);this.time1=o,this.time2=s,this.u=b,this.v=g,this.origin=v,this.lowerLeftCorner=y,this.horizontal=j,this.vertical=A,this.lensRadius=x(i,2)}return Object(v.a)(e,[{key:"getRay",value:function(e,t){var a=this.origin,n=this.lowerLeftCorner,r=this.horizontal,c=this.vertical,i=k(this.lensRadius,function(){var e;do{var t=y(Math.random(),Math.random(),0);e=w(k(2,t),y(1,1,0))}while(j(e,e)>=1);return e}()),u=p(k(this.u,i[0]),k(this.v,i[1])),o=w(p(p(n,k(e,r)),k(t,c)),a),s=p(this.time1,k(Math.random(),w(this.time2,this.time1)));return new A(p(a,u),w(o,u),s)}}]),e}(),q=function(){var e;do{var t=y(Math.random(),Math.random(),Math.random());e=w(k(2,t),y(1,1,1))}while(m.squaredLength(e)>=1);return e},z=function(){function e(t){Object(d.a)(this,e),this.albedo=t}return Object(v.a)(e,[{key:"scatter",value:function(e,t,a){var n=p(p(t.p,t.normal),q()),r=w(n,t.p);return a.scattered=new A(t.p,r,e.time),a.attenuation=this.albedo,!0}}]),e}(),C=function(e,t){return w(e,k(k(2,j(e,t)),t))},S=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;Object(d.a)(this,e),this.albedo=t,this.fuzz=Math.min(a,1)}return Object(v.a)(e,[{key:"scatter",value:function(e,t,a){var n=C(m.normalize(m.create(),e.direction()),t.normal);return a.scattered=new A(t.p,p(n,k(this.fuzz,q()))),a.attenuation=this.albedo,j(a.scattered.direction(),t.normal)>0}}]),e}(),L=function(){function e(t){Object(d.a)(this,e),this.refractIndex=t}return Object(v.a)(e,[{key:"scatter",value:function(e,t,a){var n=m.create(),r=C(e.direction(),t.normal),c=0,i=0;a.attenuation=y(1,1,1);var u=j(e.direction(),t.normal);u>0?(n=g(t.normal),c=this.refractIndex,i=x(k(this.refractIndex,u),m.length(e.direction()))):(n=t.normal,c=x(1,this.refractIndex),i=x(g(u),m.length(e.direction())));var o=0;return o=function(e,t,a,n){var r=m.normalize(m.create(),e),c=j(r,t),i=w(1,k(k(a,a),w(1,k(c,c))));return i>0&&(n.refracted=w(k(a,w(r,k(t,c))),k(t,Math.sqrt(i))),!0)}(e.direction(),n,c,a)?function(e,t){var a=x(w(1,t),p(1,t));return a=k(a,a),p(a,k(w(1,a),Math.pow(w(1,e),5)))}(i,this.refractIndex):1,Math.random()<o?a.scattered=new A(t.p,r):a.scattered=new A(t.p,a.refracted),!0}}]),e}(),P=function(e){var t=e.width,a=void 0===t?800:t,r=e.height,c=void 0===r?400:r,i=e.amount,u=void 0===i?2:i,o=e.lookFrom,s=void 0===o?y(13,2,3):o,l=e.lookAt,f=void 0===l?y(0,0,0):l,d=e.vup,v=void 0===d?y(0,1,0):d,b=e.vfov,j=void 0===b?20:b,O=e.aspect,M=void 0===O?x(a,c):O,A=e.focusDist,q=void 0===A?10:A,C=e.aperture,P=a,T=c,H=new I(s,f,v,j,M,void 0===C?.1:C,q,0,1),J=function(e){var t=[],a=Math.floor(x(Math.sqrt(e),2)),n=g(a),r=+a;t[0]=new R(y(0,-1e3,0),1e3,new z(y(.5,.5,.5)));for(var c=1,i=y(4,.2,0),u=n;u<r;u++)for(var o=n;o<r;o++){var s=Math.random(),l=y(p(u,k(.9,Math.random())),.2,p(o,k(.9,Math.random())));if(m.length(w(l,i))>.9)if(s<.8){var f=new z(y(k(Math.random(),Math.random()),k(Math.random(),Math.random()),k(Math.random(),Math.random())));t[c++]=new D(l,p(l,y(0,k(.5,Math.random()),0)),0,1,.2,f)}else if(s<.95){var h=new S(y(k(.5,p(1,Math.random())),k(.5,p(1,Math.random())),k(.5,p(1,Math.random()))),k(.5,Math.random()));t[c++]=new R(l,.2,h)}else t[c++]=new R(l,.2,new L(1.5))}return t[c++]=new R(y(0,1,0),1,new L(1.5)),t[c++]=new R(y(-4,1,0),1,new z(y(.4,.2,.1))),t[c++]=new R(y(4,1,0),1,new S(y(.7,.6,.5),0)),new _(t)}(u),W=function(e,t){var a=x(p(e,Math.random()),P),n=x(p(t,Math.random()),T);return function e(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=F();if(a.hit(t,.001,1/0,r)){var c={scattered:null,attenuation:0};return n>=50||!r.material.scatter(t,r,c)?y(0,0,0):k(c.attenuation,e(c.scattered,a,p(n,1)))}var i=m.normalize(m.create(),t.direction());return E(k(.5,p(i[1],1)),y(1,1,1),y(.5,.7,1))}(H.getRay(a,n),J)};return{render:h.a.mark((function e(){var t,a,r,c,i,u,o,s;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=w(T,1);case 1:if(!(t>=0)){e.next=20;break}a=0;case 3:if(!(a<P)){e.next=17;break}return r=W(a,t),c=Object(n.a)(r,3),i=c[0],u=c[1],o=c[2],s=1,e.next=8,i;case 8:return e.next=10,u;case 10:return e.next=12,o;case 12:return e.next=14,s;case 14:a++,e.next=3;break;case 17:t--,e.next=1;break;case 20:case"end":return e.stop()}}),e)})),renderByPosition:W}},T=function(){},H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T;return new Promise((function(t){requestAnimationFrame((function(){e(),t()}))}))},J=function(e,t){for(var a=0,n=0;n<e.length;n++)a+=Math.pow(e[n]-t[n],2);return a/e.length},W=h.a.mark((function e(t,a){var n,r=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.length>2&&void 0!==r[2]?r[2]:1;case 1:if(!(t<=a)){e.next=7;break}return e.next=4,t;case 4:t+=n,e.next=1;break;case 7:case"end":return e.stop()}}),e)})),B=h.a.mark((function e(t,a){var n,r=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.length>2&&void 0!==r[2]?r[2]:-1;case 1:if(!(t>=a)){e.next=7;break}return e.next=4,t;case 4:t+=n,e.next=1;break;case 7:case"end":return e.stop()}}),e)})),N=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e<t?W(e,t,Math.abs(a)):B(e,t,-Math.abs(a))},U=h.a.mark((function e(t,a){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.next(),r=a.next(),!n.done||!r.done){e.next=5;break}return e.abrupt("break",13);case 5:if(n.done){e.next=8;break}return e.next=8,n.value;case 8:if(r.done){e.next=11;break}return e.next=11,r.value;case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e)})),V=h.a.mark((function e(t,a){var n,r,c,i,u,o,s=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=s.length>2&&void 0!==s[2]?s[2]:1,r=Math.floor((a-t)/2),c=U(N(r,t,n),N(r+n,a,n)),i=Object(l.a)(c),e.prev=4,i.s();case 6:if((u=i.n()).done){e.next=12;break}return o=u.value,e.next=10,o;case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),i.e(e.t0);case 17:return e.prev=17,i.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,14,17,20]])})),K=function(e,t){for(var a=[],n=0;n<e.length;n+=4){var r=Math.floor(n/4),c=[e[n+0],e[n+1],e[n+2],e[n+3]],i=[t[n+0],t[n+1],t[n+2],t[n+3]];a[r]={index:r,value:J(c,i)}}return a.sort((function(e,t){return t.value-e.value}))},G=function(e){return Math.floor(255.99*Math.sqrt(e))};function Q(e){var t=Object(c.useState)(0),a=Object(n.a)(t,2),r=a[0],u=a[1],o=Object(c.useRef)(),f=Object(c.useRef)();return Object(c.useEffect)((function(){var t=o.current,a=f.current,r=t.getContext("2d"),c=a.getContext("2d"),i=r.createImageData(800,400),d=c.createImageData(800,400),v=P({width:800,height:400,amount:e.counts||0}),m=new Float32Array(128e4),b=new Float32Array(128e4),p=new Float32Array(128e4),w=new Float32Array(128e4),k=1,x=0,g=null,y=!1,j=function(){r.fillColor="rgba(0, 0, 0, 1)",r.clearRect(0,0,800,400),r.putImageData(i,0,0)},O=function(){for(var e=w,t=0;t<e.length;t++)d.data[t]=(t+1)%4===0?255:e[t];c.clearRect(0,0,800,400),c.putImageData(d,0,0)},M=function(e,t){var a=v.renderByPosition(e,t),r=Object(n.a)(a,4),c=r[0],u=r[1],o=r[2],s=r[3],l=void 0===s?1:s,f=4*(800*(399-t)+e);m[f+0]+=c,m[f+1]+=u,m[f+2]+=o,m[f+3]+=l,w[f+0]+=1,w[f+1]+=1,w[f+2]+=1,w[f+3]+=1,b[f+0]=i.data[f+0],b[f+1]=i.data[f+1],b[f+2]=i.data[f+2],b[f+3]=i.data[f+3],i.data[f+0]=G(m[f+0]/w[f+0]),i.data[f+1]=G(m[f+1]/w[f+1]),i.data[f+2]=G(m[f+2]/w[f+2]),i.data[f+3]=G(m[f+3]/w[f+3]),p[f+0]=i.data[f+0],p[f+1]=i.data[f+1],p[f+2]=i.data[f+2],p[f+3]=i.data[f+3]},A=function(){var e=Object(s.a)(h.a.mark((function e(){var t,a,n,r,c,i,o,s,f,d=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=d.length>0&&void 0!==d[0]?d[0]:1,a=Date.now(),n=0,r=Object(l.a)(V(0,399,t)),e.prev=4,r.s();case 6:if((c=r.n()).done){e.next=33;break}i=c.value,o=Object(l.a)(N(0,799,t)),e.prev=9,o.s();case 11:if((s=o.n()).done){e.next=23;break}if(f=s.value,!y){e.next=15;break}return e.abrupt("return");case 15:if(M(f,i),(n=Date.now()-a)%100!==0){e.next=21;break}return u(x+n),e.next=21,H((function(){j(),O()}));case 21:e.next=11;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(9),o.e(e.t0);case 28:return e.prev=28,o.f(),e.finish(28);case 31:e.next=6;break;case 33:e.next=38;break;case 35:e.prev=35,e.t1=e.catch(4),r.e(e.t1);case 38:return e.prev=38,r.f(),e.finish(38);case 41:1===t&&(k+=1),j(),O(),u(x+=n),k>2?E():g=requestAnimationFrame((function(){return A()}));case 46:case"end":return e.stop()}}),e,null,[[4,35,38,41],[9,25,28,31]])})));return function(){return e.apply(this,arguments)}}(),E=function(){var e=Object(s.a)(h.a.mark((function e(){var t,a,n,r,c,i,o,s,l=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=l.length>0&&void 0!==l[0]?l[0]:0,a=K(b,p),n=Date.now(),r=0,c=0;case 5:if(!(c<2e4)){e.next=20;break}if(i=a[c],o=i.index%800,s=400-Math.floor(i.index/800),M(o,s),(r=Date.now()-n)%100!==0){e.next=15;break}return u(x+r),e.next=15,H((function(){j(),O()}));case 15:if(!y){e.next=17;break}return e.abrupt("return");case 17:c++,e.next=5;break;case 20:if(!y){e.next=22;break}return e.abrupt("return");case 22:j(),u(x+=Date.now()-n),g=requestAnimationFrame((function(){t<5?E(t+1):A()}));case 25:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return A(3),function(){y=!0,clearTimeout(g)}}),[e.counts]),i.a.createElement(i.a.Fragment,null,i.a.createElement("h2",null,"Ray tracing via JavaScript"),i.a.createElement("h3",null,"Time: ",(r/1e3).toFixed(2),"s"),i.a.createElement("canvas",{width:800,height:400,ref:o,style:{background:"#000",display:"block",margin:"0 auto"}}),i.a.createElement("br",null),i.a.createElement("canvas",{width:800,height:400,ref:f,style:{display:"block",margin:"0 auto"}}))}var X=function(){},Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X;return new Promise((function(t){requestAnimationFrame((function(){e(),t()}))}))},Z=function(e,t){for(var a=0,n=0;n<e.length;n++)a+=Math.pow(e[n]-t[n],2);return a/e.length},$=h.a.mark((function e(t,a){var n,r=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.length>2&&void 0!==r[2]?r[2]:1;case 1:if(!(t<=a)){e.next=7;break}return e.next=4,t;case 4:t+=n,e.next=1;break;case 7:case"end":return e.stop()}}),e)})),ee=h.a.mark((function e(t,a){var n,r=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r.length>2&&void 0!==r[2]?r[2]:-1;case 1:if(!(t>=a)){e.next=7;break}return e.next=4,t;case 4:t+=n,e.next=1;break;case 7:case"end":return e.stop()}}),e)})),te=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e<t?$(e,t,Math.abs(a)):ee(e,t,-Math.abs(a))},ae=h.a.mark((function e(t,a){var n,r;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.next(),r=a.next(),!n.done||!r.done){e.next=5;break}return e.abrupt("break",13);case 5:if(n.done){e.next=8;break}return e.next=8,n.value;case 8:if(r.done){e.next=11;break}return e.next=11,r.value;case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e)})),ne=h.a.mark((function e(t,a){var n,r,c,i,u,o,s=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=s.length>2&&void 0!==s[2]?s[2]:1,r=Math.floor((a-t)/2),c=ae(te(r,t,n),te(r+n,a,n)),i=Object(l.a)(c),e.prev=4,i.s();case 6:if((u=i.n()).done){e.next=12;break}return o=u.value,e.next=10,o;case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),i.e(e.t0);case 17:return e.prev=17,i.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,14,17,20]])})),re=function(e,t){for(var a=[],n=0;n<e.length;n+=4){var r=Math.floor(n/4),c=[e[n+0],e[n+1],e[n+2],e[n+3]],i=[t[n+0],t[n+1],t[n+2],t[n+3]];a[r]={index:r,value:Z(c,i)}}return a.sort((function(e,t){return t.value-e.value}))},ce=function(e){return Math.floor(255.99*Math.sqrt(e))},ie=i.a.lazy(Object(s.a)(h.a.mark((function e(){var t,r,u;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.e(0).then(a.bind(null,144));case 2:return t=e.sent,r=t.Scene,u=function(e){var t=Object(c.useState)(0),a=Object(n.a)(t,2),u=a[0],o=a[1],f=Object(c.useRef)(null),d=Object(c.useRef)(null);return Object(c.useEffect)((function(){if(f.current&&d.current){var t=f.current,a=d.current,c=t.getContext("2d"),i=a.getContext("2d");if(c&&i){c.clearRect(0,0,t.clientWidth,t.clientHeight),i.clearRect(0,0,a.clientWidth,a.clientHeight);var u=c.createImageData(800,400),v=i.createImageData(800,400),m=new r(800,400,50),b=new Float32Array(128e4),p=new Float32Array(128e4),w=new Float32Array(128e4),k=new Float32Array(128e4),x=1,g=0,y=null,j=!1;m.random_scene(e.counts||0);var O=function(){c&&(c.fillStyle="rgba(0, 0, 0, 1)",c.clearRect(0,0,800,400),c.putImageData(u,0,0))},M=function(){if(i){for(var e=k,t=0;t<e.length;t++)v.data[t]=(t+1)%4===0?255:e[t];i.clearRect(0,0,800,400),i.putImageData(v,0,0)}},A=function(e,t){var a=m.render_by_position(e,t),r=Object(n.a)(a,4),c=r[0],i=r[1],o=r[2],s=r[3],l=void 0===s?1:s,f=4*(800*(399-t)+e);b[f+0]+=c,b[f+1]+=i,b[f+2]+=o,b[f+3]+=l,k[f+0]+=1,k[f+1]+=1,k[f+2]+=1,k[f+3]+=1,p[f+0]=u.data[f+0],p[f+1]=u.data[f+1],p[f+2]=u.data[f+2],p[f+3]=u.data[f+3],u.data[f+0]=ce(b[f+0]/k[f+0]),u.data[f+1]=ce(b[f+1]/k[f+1]),u.data[f+2]=ce(b[f+2]/k[f+2]),u.data[f+3]=ce(b[f+3]/k[f+3]),w[f+0]=u.data[f+0],w[f+1]=u.data[f+1],w[f+2]=u.data[f+2],w[f+3]=u.data[f+3]},E=function(){var e=Object(s.a)(h.a.mark((function e(){var t,a,n,r,c,i,u,s,f,d,v=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=v.length>0&&void 0!==v[0]?v[0]:1,a=Date.now(),n=0,r=0,c=Object(l.a)(ne(0,399,t)),e.prev=5,c.s();case 7:if((i=c.n()).done){e.next=37;break}u=i.value,s=Object(l.a)(te(0,799,t)),e.prev=10,s.s();case 12:if((f=s.n()).done){e.next=27;break}if(d=f.value,!j){e.next=16;break}return e.abrupt("return");case 16:if(A(d,u),!((n=Date.now()-a)/100>r)){e.next=25;break}if(r+=1,!j){e.next=22;break}return e.abrupt("return");case 22:return o(g+n),e.next=25,Y((function(){O(),M()}));case 25:e.next=12;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(10),s.e(e.t0);case 32:return e.prev=32,s.f(),e.finish(32);case 35:e.next=7;break;case 37:e.next=42;break;case 39:e.prev=39,e.t1=e.catch(5),c.e(e.t1);case 42:return e.prev=42,c.f(),e.finish(42);case 45:if(1===t&&(x+=1),O(),M(),!j){e.next=50;break}return e.abrupt("return");case 50:o(g+=n),x>2?F():y=requestAnimationFrame((function(){return E()}));case 52:case"end":return e.stop()}}),e,null,[[5,39,42,45],[10,29,32,35]])})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=Object(s.a)(h.a.mark((function e(){var t,a,n,r,c,i,u,s,l=arguments;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=l.length>0&&void 0!==l[0]?l[0]:0,a=re(p,w),n=Date.now(),r=0,c=0;case 5:if(!(c<2e4)){e.next=22;break}if(i=a[c],u=i.index%800,s=400-Math.max(Math.floor(i.index/800),1),A(u,s),(r=Date.now()-n)%100!==0){e.next=17;break}if(!j){e.next=14;break}return e.abrupt("return");case 14:return o(g+r),e.next=17,Y((function(){O(),M()}));case 17:if(!j){e.next=19;break}return e.abrupt("return");case 19:c++,e.next=5;break;case 22:if(!j){e.next=24;break}return e.abrupt("return");case 24:O(),o(g+=Date.now()-n),y=requestAnimationFrame((function(){t<5?F(t+1):E()}));case 27:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();E(3);var R=function(e){var t=0;switch(e.key){case"ArrowUp":case"w":t=0;break;case"ArrowDown":case"s":t=1;break;case"ArrowLeft":case"a":t=2;break;case"ArrowRight":case"d":t=3;break;default:return}m.process_keyboard(t),c&&i&&(i.clearRect(0,0,a.clientWidth,a.clientHeight),u=c.createImageData(800,400),v=i.createImageData(800,400),b=new Float32Array(128e4),p=new Float32Array(128e4),w=new Float32Array(128e4),k=new Float32Array(128e4),x=1,g=0,y=null,j=!1)};return document.addEventListener("keydown",R,!1),function(){document.removeEventListener("keydown",R,!1),j=!0,clearTimeout(y)}}}}),[e.counts]),i.a.createElement(i.a.Fragment,null,i.a.createElement("h2",null,"Ray tracing via Rust"),i.a.createElement("h3",null,"Time: ",(u/1e3).toFixed(2),"s"),i.a.createElement("div",null,"Press arrow keys or w/s/a/d to change the viewpoint"),i.a.createElement("canvas",{width:800,height:400,ref:f,style:{background:"#000",display:"block",margin:"0 auto"}}),i.a.createElement("br",null),i.a.createElement("canvas",{width:800,height:400,ref:d,style:{display:"block",margin:"0 auto"}}))},e.abrupt("return",{default:u});case 6:case"end":return e.stop()}}),e)})))),ue=a(68),oe=a.n(ue),se=function(){},le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se;return new Promise((function(t){requestAnimationFrame((function(){e(),t()}))}))},fe=function(e){return Math.floor(255.99*Math.sqrt(e))},he=i.a.lazy(Object(s.a)(h.a.mark((function e(){var t,r,u;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.e(0).then(a.bind(null,144));case 2:return t=e.sent,r=t.Scene,u=function(e){var t=Object(c.useState)(0),a=Object(n.a)(t,2),u=a[0],o=a[1],l=Object(c.useRef)(null),f=Object(c.useRef)(null);return Object(c.useEffect)((function(){if(l.current){var e=l.current,t=(f.current,e.getContext("2d"));if(t){t.clearRect(0,0,e.clientWidth,e.clientHeight);var a=t.createImageData(200,100),n=new r(200,100,50),c=new Float32Array(8e4),i=new Float32Array(8e4),u=new Float32Array(8e4),d=new Float32Array(8e4),v=1,m=0,b=null,p=!1;n.random_scene(100);var w=function(){var e=Object(s.a)(h.a.mark((function e(){var r,s,l,f,k,x,g,y,j;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!p){e.next=2;break}return e.abrupt("return");case 2:for(r=v,s=Date.now(),l=0,f=n.render(),k=0;k<f.length;)x=k/3*4,g=f[k++],y=f[k++],j=f[k++],1,c[x+0]+=g,c[x+1]+=y,c[x+2]+=j,c[x+3]+=1,d[x+0]+=1,d[x+1]+=1,d[x+2]+=1,d[x+3]+=1,i[x+0]=a.data[x+0],i[x+1]=a.data[x+1],i[x+2]=a.data[x+2],i[x+3]=a.data[x+3],a.data[x+0]=fe(c[x+0]/d[x+0]),a.data[x+1]=fe(c[x+1]/d[x+1]),a.data[x+2]=fe(c[x+2]/d[x+2]),a.data[x+3]=fe(c[x+3]/d[x+3]),u[x+0]=a.data[x+0],u[x+1]=a.data[x+1],u[x+2]=a.data[x+2],u[x+3]=a.data[x+3];if(!p){e.next=9;break}return e.abrupt("return");case 9:return o(m+l),e.next=12,le((function(){r===v&&t&&(t.fillStyle="rgba(0, 0, 0, 1)",t.clearRect(0,0,200,100),t.putImageData(a,0,0));var e=Date.now()-s;p||o(m+=e)}));case 12:b=requestAnimationFrame(w);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();w();var k=oe()((function(e){var r=0;switch(e.key){case"ArrowUp":case"w":r=0;break;case"ArrowDown":case"s":r=1;break;case"ArrowLeft":case"a":r=2;break;case"ArrowRight":case"d":r=3;break;default:return}n.process_keyboard(r),t&&(a=t.createImageData(200,100),c=new Float32Array(8e4),i=new Float32Array(8e4),u=new Float32Array(8e4),d=new Float32Array(8e4),v+=1,m=0,b=null,p=!1)}),200);return document.addEventListener("keydown",k,!1),function(){document.removeEventListener("keydown",k,!1),p=!0,clearTimeout(b)}}}}),[e.counts]),i.a.createElement(i.a.Fragment,null,i.a.createElement("h2",null,"Ray tracing via Rust"),i.a.createElement("h3",null,"Time: ",(u/1e3).toFixed(2),"s"),i.a.createElement("div",null,"Press arrow keys or w/s/a/d to change the viewpoint"),i.a.createElement("div",{style:{height:400}},i.a.createElement("canvas",{width:200,height:100,ref:l,style:{display:"block",marginLeft:"auto",marginRight:"auto",marginTop:150,background:"#000",transform:"scale(4)"}})))},e.abrupt("return",{default:u});case 6:case"end":return e.stop()}}),e)})))),de=(a(85),a(86),a(138)),ve=a(139),me=de.a.Header,be=de.a.Content,pe=de.a.Footer,we=Object(r.a)({JavaScript:Q,Rust:ie},"Rust: Small image",he),ke=function(){var e=Object(c.useState)("Rust"),t=Object(n.a)(e,2),a=t[0],r=t[1],u=Object(c.useState)(100),o=Object(n.a)(u,2),s=o[0],l=(o[1],we[a]||Q);return i.a.createElement(de.a,{className:"layout"},i.a.createElement(me,null,i.a.createElement("div",{className:"logo"}),i.a.createElement(ve.a,{theme:"dark",mode:"horizontal",selectedKeys:[a]},Object.keys(we).map((function(e){return i.a.createElement(ve.a.Item,{key:e,onClick:function(){r(e)}},e)})))),i.a.createElement(be,{style:{padding:"0 250px"}},i.a.createElement("div",{className:"site-layout-content"},i.a.createElement(c.Suspense,{fallback:"loading..."},i.a.createElement(l,{counts:s})))),i.a.createElement(pe,{style:{textAlign:"center"}},i.a.createElement("a",{href:"https://github.com/Lucifier129/rust-ray-tracing-demo"},"Ray Tracing Demos Created by \u5de5\u4e1a\u805a")))};o.a.render(i.a.createElement(ke,null),document.getElementById("root"))},78:function(e,t,a){e.exports=a(136)},84:function(e,t,a){var n=a(66).vec3,r=function(e){return e instanceof Float32Array},c=function(e){return n.fromValues(e,e,e)};e.exports={_add_:function(e,t){return r(e)||r(t)?(r(e)||(e=c(e)),r(t)||(t=c(t)),n.add(n.create(),e,t)):e+t},_sub_:function(e,t){return r(e)||r(t)?(r(e)||(e=c(e)),r(t)||(t=c(t)),n.sub(n.create(),e,t)):e-t},_mul_:function(e,t){return r(e)||r(t)?(r(e)||(e=c(e)),r(t)||(t=c(t)),n.mul(n.create(),e,t)):e*t},_div_:function(e,t){return r(e)||r(t)?(r(e)||(e=c(e)),r(t)||(t=c(t)),n.div(n.create(),e,t)):e/t},_negate_:function(e){return r(e)?n.negate(n.create(),e):-e}}},86:function(e,t,a){}},[[78,2,3]]]);
//# sourceMappingURL=main.bd68855b.chunk.js.map